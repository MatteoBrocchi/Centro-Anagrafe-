$(function(){var n,e,o,t,i=1,a=new Array,r=new Array,c=new Array,l=(localStorage.getItem("idprova"),!1),s=!1,d=!1,m=!1,p=!1,u=!1;function g(e){$(".pagination").empty(),n=e.matrimoni.length%$("#shownumber").val()==0?parseInt(e.matrimoni.length/$("#shownumber").val()):parseInt(e.matrimoni.length/$("#shownumber").val()+1),$(".pagination").append('<li class="page-item" id="previous"> <a class="page-link" href="#main" tabindex="-1"  style="text-decoration:none"aria-disabled="true">Precedente</a> </li>');for(let e=0;e<n;e++)$(".pagination").append('<li class="page-item numeri"><a class="page-link" style="text-decoration:none" href="#main">'+(e+1)+"</a></li>");$(".pagination").append('<li class="page-item" id="next"> <a class="page-link" href="#main" style="text-decoration:none"tabindex="-1" aria-disabled="true">Successivo</a> </li>'),h(1,$("#shownumber").val(),e)}function v(){$("#persone").empty()}function h(n,e,o){let t=0;$("#nomePersonaSelezionata").text(o.nome+" "+o.cognome),v(),t=o.matrimoni.length<e*n?o.matrimoni.length:e*n;for(let i=n*e-e;i<t;i++){let n=o.matrimoni[i].anno.split("-")[2]+"-"+o.matrimoni[i].anno.split("-")[1]+"-"+o.matrimoni[i].anno.split("-")[0];$("#persone").append("<tr><td>"+o.matrimoni[i].nome_coniuge+"</td><td>"+o.matrimoni[i].cognome_coniuge+"</td><td>"+n+"</td><td>"+o.matrimoni[i].comune+'</td><td class="d-flex justify-content-center bottoni"><i class="fas fa-trash-alt delete rounded" title="Elimina" id="'+(i+1)+'" data-toggle="modal" data-target="#modalEliminaRes"></i><i class="fas fa-edit edit rounded" title="Modifica" id="'+(i+1)+'" data-toggle="modal" data-target="#exampleModalEdit"></i></td></tr>')}}function f(n,e){let o=0;return n>e?o=1:n<e&&(o=-1),o}$.ajax({type:"GET",contentType:"application/json",url:"https://late-frost-5190.getsandbox.com/anagrafiche",dataType:"json",success:function(n){$.each(n,function(n,e){a.push(Object.assign({},e))});for(let n=0;n<a.length;n++)a[n].id==localStorage.getItem("idprova")&&(n=(a=a[n]).length);g(a),document.getElementById("loading_screen").style.display="none"}}),$.ajax({type:"GET",contentType:"application/json",url:"https://late-frost-5190.getsandbox.com/territorio",dataType:"json",success:function(n){$.each(n,function(n,e){c.push(Object.assign({},e)),c=c[0];for(let n=0;n<20;n++){$(".regioni").append(new Option(c[n].nome,c[n].nome));for(let e=0;e<c[n].province.length;e++){$(".province").append(new Option(c[n].province[e].nome));for(let o=0;o<c[n].province[e].comuni.length;o++)$(".comuni").append(new Option(c[n].province[e].comuni[o])),$("#birthPlace").append(new Option(c[n].province[e].comuni[o]))}}})}}),$(document).on("change",".regioni",function(){$(".province").empty(),$(".comuni").empty(),$(".province").append(new Option("Seleziona provincia")),$(".comuni").append(new Option("Seleziona comune"));for(var n=$(".regioni").val(),e=0;e<20;e++)if(c[e].nome==n)for(let n=0;n<c[e].province.length;n++){$(".province").append(new Option(c[e].province[n].nome,c[e].province[n].nome));for(let o=0;o<c[e].province[n].comuni.length;o++)$(".comuni").append(new Option(c[e].province[n].comuni[o],c[e].province[n].comuni[o]))}}),$(document).on("click"),$(document).on("change",".province",function(){$(".comuni").empty(),$(".comuni").append(new Option("Seleziona comune"));for(var n=$(".province").val(),e=0;e<20;e++)for(var o=0;o<c[e].province.length;o++)if(c[e].province[o].nome==n){$(".regioni").val(c[e].nome);for(var t=0;t<c[e].province[o].comuni.length;t++)$(".comuni").append(new Option(c[e].province[o].comuni[t],c[e].province[o].comuni[t]))}}),$(document).on("change",".comuni",function(){for(var n=$(".comuni").val(),e=0;e<20;e++)for(var o=0;o<c[e].province.length;o++)for(var t=0;t<c[e].province[o].comuni.length;t++)c[e].province[o].comuni[t]==n&&($(".regioni").val(c[e].nome),$(".province").val(c[e].province[o].nome),$(".comuni").val(n))}),$(document).on("keyup","#search",function(){r.length=0,v();var n=0,e=$(this).val();e?(e=e.toLowerCase(),$.each(a,function(o,t){t.matrimoni.length;-1!=t.codice.toLowerCase().indexOf(e)&&(r[n]=t,n++)}),g(r)):g(a)}),$(document).on("click",".btnNuovoMatrimonio",function(){dt='{"nome_coniuge":"'+$("#nomeNuovoConiuge").val().toString()+'","cognome_coniuge":"'+$("#cognomeNuovoConiuge").val().toString()+'","anno":"'+$("#dataNuovoMatrimonio").val().toString()+'","comune":"'+$("#comuneNuovoMatrimonio").val().toString()+'","codice":"'+$("#editcodicecarta").val().toString()+'"}',$.ajax({type:"POST",headers:{"Access-Control-Allow-Origin":"*"},data:dt,contentType:"application/json",crossDomain:!0,url:"https://late-frost-5190.getsandbox.com/anagrafiche/add/"+localStorage.getItem("idprova")+"/matrimonio/",dataType:"json",success:function(n){},error:function(n,e,o){$("#btnNuovoMatrimonio").modal("toggle"),document.getElementById("loading_screen").style.display="block",v(),a=[],$.ajax({type:"GET",contentType:"application/json",url:"https://late-frost-5190.getsandbox.com/anagrafiche",dataType:"json",success:function(n){$.each(n,function(n,e){a.push(Object.assign({},e))});for(let n=0;n<a.length;n++)a[n].id==localStorage.getItem("idprova")&&(n=(a=a[n]).length);g(a),document.getElementById("loading_screen").style.display="none"}})}})}),$("#shownumber").change(function(){g(a)}),$(document).on("click",".edit",function(){e=$(this).attr("id"),o=localStorage.getItem("idprova"),$("#editNuovoConiuge").val(a.matrimoni[e-1].nome_coniuge),$("#editcognomeNuovoConiuge").val(a.matrimoni[e-1].cognome_coniuge),$("#editdataNuovoMatrimonio").val(a.matrimoni[e-1].anno),$("#editcomuneNuovoMatrimonio").val(a.matrimoni[e-1].comune)}),$(document).on("click",".inviaModifica",function(){dt='{"nome_coniuge":"'+$("#editNuovoConiuge").val().toString()+'","cognome_coniuge":"'+$("#editcognomeNuovoConiuge").val().toString()+'","anno":"'+$("#editdataNuovoMatrimonio").val().toString()+'","comune":"'+$("#editcomuneNuovoMatrimonio").val().toString()+'"}',$.ajax({type:"POST",headers:{"Access-Control-Allow-Origin":"*"},data:dt,contentType:"application/json",crossDomain:!0,url:"https://late-frost-5190.getsandbox.com/anagrafiche/edit/"+o+"/matrimonio/"+e+"/",dataType:"json",success:function(n){}}),$("#exampleModalEdit").modal("toggle"),document.getElementById("loading_screen").style.display="block",v(),a=[],$.ajax({type:"GET",contentType:"application/json",url:"https://late-frost-5190.getsandbox.com/anagrafiche",dataType:"json",success:function(n){$.each(n,function(n,e){a.push(Object.assign({},e))});for(let n=0;n<a.length;n++)a[n].id==localStorage.getItem("idprova")&&(n=(a=a[n]).length);g(a),document.getElementById("loading_screen").style.display="none"}})}),$(document).on("click",".delete",function(){e=$(this).attr("id"),o=localStorage.getItem("idprova")}),$(document).on("click",".btnElimina",function(){$.ajax({type:"DELETE",headers:{"Access-Control-Allow-Origin":"*"},contentType:"application/json",url:"https://late-frost-5190.getsandbox.com/anagrafiche/remove/"+o+"/matrimonio/"+e+"/",dataType:"json"}).then(function(n){$(".bottoni .delete").each(function(){$(this).attr("id")==e&&$(this).parent().parent().remove()})},function(n,o,t){$(".bottoni .delete").each(function(){$(this).attr("id")==e&&$(this).parent().parent().remove()})})}),$(document).on("click",".order",function(){var n=new Array;switch($(this).attr("id")){case"nome":for(let e=0;e<a.length;e++){for(let o=e+1;o<a.length;o++)l?f(a[o].nome,a[e].nome)>0&&(n=a[o],a[o]=a[e],a[e]=n):f(a[o].nome,a[e].nome)<0&&(n=a[e],a[e]=a[o],a[o]=n);g(a)}l=!l;break;case"cognome":for(let e=0;e<a.length;e++){for(let o=e+1;o<a.length;o++)s?f(a[o].cognome,a[e].cognome)>0&&(n=a[o],a[o]=a[e],a[e]=n):f(a[o].cognome,a[e].cognome)<0&&(n=a[e],a[e]=a[o],a[o]=n);g(a)}s=!s;break;case"regione":for(let t=0;t<a.length;t++){for(let i=t+1;i<a.length;i++){var e=a[i].luoghi_residenza.length,o=a[t].luoghi_residenza.length;d?f(a[i].luoghi_residenza[e-1].regione,a[t].luoghi_residenza[o-1].regione)>0&&(n=a[i],a[i]=a[t],a[t]=n):f(a[i].luoghi_residenza[e-1].regione,a[t].luoghi_residenza[o-1].regione)<0&&(n=a[t],a[t]=a[i],a[i]=n)}g(a)}d=!d;break;case"provincia":for(let t=0;t<a.length;t++){for(let i=t+1;i<a.length;i++){e=a[i].luoghi_residenza.length,o=a[t].luoghi_residenza.length;m?f(a[i].luoghi_residenza[e-1].provincia,a[t].luoghi_residenza[o-1].provincia)>0&&(n=a[i],a[i]=a[t],a[t]=n):f(a[i].luoghi_residenza[e-1].provincia,a[t].luoghi_residenza[o-1].provincia)<0&&(n=a[t],a[t]=a[i],a[i]=n)}g(a)}m=!m;break;case"comune":for(let t=0;t<a.length;t++){for(let i=t+1;i<a.length;i++){e=a[i].luoghi_residenza.length,o=a[t].luoghi_residenza.length;p?f(a[i].luoghi_residenza[e-1].comune,a[t].luoghi_residenza[o-1].comune)>0&&(n=a[i],a[i]=a[t],a[t]=n):f(a[i].luoghi_residenza[e-1].comune,a[t].luoghi_residenza[o-1].comune)<0&&(n=a[t],a[t]=a[i],a[i]=n)}g(a)}p=!p;break;case"anno":for(let e=0;e<a.length;e++){for(let o=e+1;o<a.length;o++)u?f(a[o].anno_nascita,a[e].anno_nascita)>0&&(n=a[o],a[o]=a[e],a[e]=n):f(a[o].anno_nascita,a[e].anno_nascita)<0&&(n=a[e],a[e]=a[o],a[o]=n);g(a)}u=!u}}),$(document).on("click","#previous",function(){1==i&&i++,h(--i,$("#shownumber").val(),a)}),$(document).on("click","#next",function(){i==n&&i--,h(++i,$("#shownumber").val(),a)}),$(document).on("click",".numeri>.page-link",function(){var n=$(this).text();i=n,h(n,$("#shownumber").val(),a)}),t=!1,$(window).scroll(function(){$(this).scrollTop()>100?(t||($("#nav>ul").prepend("<li class='titolo'>Ufficio Anagrafe</li>"),t=!0),$("#nav").addClass("shrink")):(t&&($("#nav>ul").find(":first").remove(),t=!1),$("#nav").removeClass("shrink"))});var y=$(window),b=$("body");breakpoints({xlarge:["1281px","1680px"],large:["981px","1280px"],medium:["737px","980px"],small:[null,"736px"]}),y.on("load",function(){window.setTimeout(function(){b.removeClass("is-preload")},100)}),$("#nav > ul").dropotron({mode:"fade",noOpenerFade:!0,alignment:"center"}),$('<div id="titleBar"><a href="#navPanel" class="toggle"></a></div>').appendTo(b),$('<div id="navPanel"><nav>'+$("#nav").navList()+"</nav></div>").appendTo(b).panel({delay:500,hideOnClick:!0,hideOnSwipe:!0,resetScroll:!0,resetForms:!0,side:"left",target:b,visibleClass:"navPanel-visible"})});
